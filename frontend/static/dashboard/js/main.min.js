const delete_btn=document.querySelectorAll(".main__group-item--btn"),admin_delete_btn=document.querySelectorAll(".main__groups-admin--btn-close"),admin_share_btn=document.querySelectorAll(".main__groups-admin--btn-share"),add_group_window=document.querySelector(".add_group"),add_group_close_btn=document.querySelector(".add_group-wrapper--btn"),add_group_add_btn=document.querySelector(".add_group-btn"),add_group_create_btn=document.querySelector(".add_group-create--btn"),add_group_input=document.querySelector(".add_group-input"),error_window=document.querySelector(".error__window"),warning_window=document.querySelector(".warning__window"),success_window=document.querySelector(".success__window"),jwt_input=document.getElementById("jwt"),rjwt_input=document.getElementById("rjwt"),localStorage=window.localStorage;localStorage.setItem("jwt",jwt_input.value),localStorage.setItem("rjwt",rjwt_input.value),document.body.removeChild(jwt_input),document.body.removeChild(rjwt_input),setInterval(()=>{newJWT()},870000),setInterval(()=>{newRJWT()},604770000),window.addEventListener("online",()=>{success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let a=warning_window.children[0];a.innerHTML="\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0441 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u043E\u043C!",warning_window.classList.add("active"),setTimeout(()=>{warning_window.classList.remove("active")},4e3)}),window.addEventListener("offline",()=>{success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let a=warning_window.children[0];a.innerHTML="\u041F\u043E\u0442\u0435\u0440\u044F\u043D\u043D\u043E \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0441 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u043E\u043C!",warning_window.classList.add("active")}),delete_btn.forEach(a=>{a.addEventListener("click",()=>{let b=a.parentNode.parentNode,c=a.parentNode,d=c.children[0].innerText;delete_group(b,c,d)})}),admin_delete_btn.forEach(a=>{a.addEventListener("click",()=>{if(confirm("\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443? \u0422\u0430\u043A \u043A\u0430\u043A \u0432\u044B \u0435\u0451 \u0432\u043B\u0430\u0434\u0435\u043B\u0435\u0446, \u043E\u043D\u0430 \u0443\u0434\u0430\u043B\u0438\u0442\u0441\u044F \u0434\u043B\u044F \u0432\u0441\u0435\u0445.")){let b=a.parentNode.parentNode,c=a.parentNode,d=c.children[0].innerText;delete_group(b,c,d)}})}),admin_share_btn.forEach(a=>{a.addEventListener("click",()=>{let b=a.parentNode.parentNode.children[0].dataset.link;navigator.clipboard.writeText(b).then(()=>{showSuccess("\u0421\u0441\u044B\u043B\u043A\u0430-\u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043D\u0430 \u0432\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0435 \u0432 \u0433\u0440\u0443\u043F\u043F\u0443 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430!")},()=>{showError("\u0421\u0441\u044B\u043B\u043A\u0430-\u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043D\u0430 \u0432\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0435 \u0432 \u0433\u0440\u0443\u043F\u043F\u0443 \u043D\u0435 \u0431\u044B\u043B\u0430 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430!")})})}),add_group_create_btn.addEventListener("click",()=>{add_group_input.focus(),add_group_window.classList.add("active")}),add_group_close_btn.addEventListener("click",()=>{add_group_input.value="",add_group_window.classList.remove("active")}),add_group_add_btn.addEventListener("click",()=>{if(""!=add_group_input.value){let a=add_group_input.value.replaceAll(/[\r\n\t]/g,"");add_group_input.value="",add_group_input.focus(),group_exists=!1;let b=document.querySelectorAll(".main__group-item--text");b.forEach(b=>{b.innerText==a&&(showError("\u0413\u0440\u0443\u043F\u043F\u0430 \u0441 \u0442\u0430\u043A\u0438\u043C \u0438\u043C\u0435\u043D\u0435\u043C \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!"),group_exists=!0)}),group_exists||(parents=[],childs=[],parent1=document.querySelector(".main__groups-list"),parent2=document.querySelector(".main__groups-admin"),item_list=document.createElement("div"),item_list_p=document.createElement("p"),item_list_button=document.createElement("button"),item_list_img=document.createElement("img"),item_admin=document.createElement("div"),item_admin_p=document.createElement("p"),item_admin_button=document.createElement("button"),item_admin_img_share=document.createElement("img"),item_admin_img_close=document.createElement("img"),item_list.classList.add("main__group-item"),item_list_p.classList.add("main__group-item--text"),item_list_button.classList.add("main__group-item--btn"),item_list_img.classList.add("main__group-item--img"),item_list_img.src="/static/dashboard/img/close.svg",item_list_img.style.width="20px",item_list_img.style.height="20px",item_list_p.innerText=a,item_list_button.appendChild(item_list_img),item_list.appendChild(item_list_p),item_list.appendChild(item_list_button),item_admin.classList.add("main__group-item"),item_admin_p.classList.add("main__group-item--text"),item_admin_p.classList.add("main__groups-admin--text"),item_admin_button.classList.add("main__groups-admin--btns"),item_admin_img_share.classList.add("main__group-item--img"),item_admin_img_close.classList.add("main__group-item--img"),item_admin_img_share.classList.add("main__groups-admin--btn-share"),item_admin_img_close.classList.add("main__groups-admin--btn-close"),item_admin_img_share.src="/static/dashboard/img/share.svg",item_admin_img_share.style.width="20px",item_admin_img_share.style.height="20px",item_admin_img_close.src="/static/dashboard/img/close.svg",item_admin_img_close.style.width="20px",item_admin_img_close.style.height="20px",item_admin_p.innerText=a,item_admin_button.appendChild(item_admin_img_share),item_admin_button.appendChild(item_admin_img_close),item_admin.appendChild(item_admin_p),item_admin.appendChild(item_admin_button),childs[0]=item_list,childs[1]=item_admin,parents[0]=parent1,parents[1]=parent2,add_group(parents,childs,a))}else showError("\u0418\u043C\u044F \u0433\u0440\u0443\u043F\u043F\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C!")});function add_group(a,b,c){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"add_group",data:{jwt:localStorage.getItem("jwt"),group_name:encodeURI(c)}})}).then(d=>{let e=d.status;return 200==e?d.json():void(400==e?document.location.reload():401==e?(newJWT(),add_group(a,b,c)):500==e?document.location.reload():503==e&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{add_group(a,b,c)},5e3)))}).then(c=>{c.success?(b[1].children[0].setAttribute("data-link",c.data.link),a[0].appendChild(b[0]),a[1].appendChild(b[1]),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function delete_group(a,b,c){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"delete_group",data:{jwt:localStorage.getItem("jwt"),group_name:encodeURI(c)}})}).then(d=>{let e=d.status;return 200==e?d.json():void(400==e?document.location.reload():401==e?(newJWT(),delete_group(a,b,c)):500==e?document.location.reload():503==e&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{delete_group(a,b,c)},5e3)))}).then(c=>{c.success?(a.removeChild(b),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u043E \u044D\u043B\u0435\u043C\u0435\u043D\u0442!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function newRJWT(){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"new_rjwt",data:{rjwt:localStorage.getItem("rjwt")}})}).then(a=>{let b=a.status;return 200==b?a.json():void(400==b?document.location.reload():401==b?document.location.reload():500==b?newRJWT():503==b&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0432\u043E\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0438\u043C \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{newRJWT()},5e3)))}).then(a=>{a.success&&(localStorage.setItem("jwt",a.data.jwt),localStorage.setItem("rjwt",a.data.rjwt))}).catch(()=>{})}function newJWT(){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"new_jwt",data:{jwt:localStorage.getItem("jwt")}})}).then(a=>{let b=a.status;return 200==b?a.json():void(400==b?document.location.reload():401==b?newRJWT():500==b?document.location.reload():503==b&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0432\u043E\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0438\u043C \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{newJWT()},5e3)))}).then(a=>{a.success&&localStorage.setItem("jwt",a.data.jwt)}).catch(()=>{})}function showError(a){success_window.classList.contains("active")&&success_window.classList.remove("active"),warning_window.classList.contains("active")&&warning_window.classList.remove("active");let b=error_window.children[0];b.innerHTML=a,error_window.classList.add("active"),setTimeout(()=>{error_window.classList.remove("active")},1e4)}function showWarning(a){success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let b=warning_window.children[0];b.innerHTML=a,warning_window.classList.add("active"),setTimeout(()=>{warning_window.classList.remove("active")},1e4)}function showSuccess(a){error_window.classList.contains("active")&&error_window.classList.remove("active"),warning_window.classList.contains("active")&&warning_window.classList.remove("active");let b=success_window.children[0];b.innerHTML=a,success_window.classList.add("active"),setTimeout(()=>{success_window.classList.remove("active")},1e4)}String.prototype.escape=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return this.replace(/[&<>]/g,function(b){return a[b]||b})};