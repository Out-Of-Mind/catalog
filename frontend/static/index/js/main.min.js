const search_input=document.querySelector(".header__search-input"),search_btn=document.querySelector(".header__search-btn"),add_window_btn=document.querySelector(".header__add-btn"),delete_btn=document.querySelectorAll(".main__group-item--btn"),main=document.querySelector(".main"),add_window=document.querySelector(".add"),add_window_close_btn=document.querySelector(".add__btn-close"),add_window_add_btn=document.querySelector(".add__btn-add"),add_window_input_category=document.querySelector(".add__input-category"),add_window_input_description=document.querySelector(".add__input-description"),menu_btn=document.querySelector(".menu-btn"),menu_img=document.querySelector(".menu-img"),menu_window=document.querySelector(".menu__window"),menu_window_add=document.querySelector(".menu__window-add"),menu_window_delete=document.querySelector(".menu__window-delete"),menu_window_add_close=document.querySelector(".menu__window-add__btn-close"),menu_window_delete_close=document.querySelector(".menu__window-delete__btn-close"),menu_window_add_btn=document.querySelector(".menu__window-btn--add"),menu_window_delete_btn=document.querySelector(".menu__window-btn--delete"),menu_window_add_category=document.querySelector(".menu__window-add__btn"),menu_window_delete_category=document.querySelector(".menu__window-delete__btn"),menu_window_add_input_category=document.querySelector(".menu__window-add__input-category"),menu_window_delete_input_category=document.querySelector(".menu__window-delete__input-category"),search_div=document.querySelector(".search"),search_output=document.querySelector(".search__output"),search_close=document.querySelector(".search__nav-btn"),error_window=document.querySelector(".error__window"),warning_window=document.querySelector(".warning__window"),success_window=document.querySelector(".success__window"),jwt_input=document.getElementById("jwt"),rjwt_input=document.getElementById("rjwt"),localStorage=window.localStorage;localStorage.setItem("jwt",jwt_input.value),localStorage.setItem("rjwt",rjwt_input.value),document.body.removeChild(jwt_input),document.body.removeChild(rjwt_input),setInterval(()=>{newJWT()},870000),setInterval(()=>{newRJWT()},604770000),window.addEventListener("online",()=>{success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let a=warning_window.children[0];a.innerHTML="\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0441 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u043E\u043C!",warning_window.classList.add("active"),setTimeout(()=>{warning_window.classList.remove("active")},4e3)}),window.addEventListener("offline",()=>{success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let a=warning_window.children[0];a.innerHTML="\u041F\u043E\u0442\u0435\u0440\u044F\u043D\u043D\u043E \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0441 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u043E\u043C!",warning_window.classList.add("active")}),search_btn.addEventListener("click",()=>{""==search_input.value?showError("\u041D\u0435 \u0432\u0432\u0435\u0434\u0435\u043D\u043E \u043D\u0438\u043A\u0430\u043A\u0438\u0445 \u0434\u0430\u043D\u043D\u044B\u0445!"):(search(search_input.value),search_input.value="")}),search_close.addEventListener("click",()=>{search_output.classList.remove("active"),search_div.classList.remove("active"),main.classList.remove("disable"),search_output.innerHTML=""}),add_window_btn.addEventListener("click",()=>{add_window.classList.add("active"),add_window_input_category.focus()}),add_window_add_btn.addEventListener("click",()=>{if(""==add_window_input_category.value||""==add_window_input_description.value)showError("\u0412\u0441\u0435 \u043F\u043E\u043B\u044F \u0434\u043E\u043B\u0436\u043D\u044B \u0431\u044B\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u044B!");else{let a=add_window_input_category.value,b=add_window_input_description.value.escape(),c=document.getElementById(a.escape().toLowerCase().replaceAll(" ","_"));if(!c)showError("\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0441 \u0442\u0430\u043A\u0438\u043C \u0438\u043C\u0435\u043D\u0435\u043C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E!");else{error_window.classList.contains("active")&&error_window.classList.remove("active"),add_window_input_description.value="";let d=document.createElement("div"),e=document.createElement("p"),f=document.createElement("button"),g=document.createElement("img");d.classList.add("main__group-item"),e.classList.add("main__group-item--text"),f.classList.add("main__group-item--btn"),g.classList.add("main__group-item--img"),g.src="img/close.svg",g.alt="close",g.style.width="20px",g.style.height="20px",e.innerHTML=b,f.appendChild(g),d.appendChild(e),d.appendChild(f),f.addEventListener("click",()=>{let a=f.parentNode;f.parentNode.parentNode.removeChild(a)}),add_item(c,d,e.innerText,a)}}}),delete_btn.forEach(a=>{a.addEventListener("click",()=>{let b=a.parentNode.parentNode,c=a.parentNode,d=c.innerText,e=b.children[0].innerText;delete_item(b,c,d,e)})}),add_window_close_btn.addEventListener("click",()=>{add_window.classList.remove("active"),add_window_input_category.value="",add_window_input_description.value=""}),menu_btn.addEventListener("click",()=>{menu_img.classList.toggle("animate"),menu_window.classList.toggle("active")}),menu_window_add_btn.addEventListener("click",()=>{menu_window_delete.classList.contains("active")&&menu_window_delete.classList.remove("active"),menu_window_add.classList.add("active"),menu_window_add_input_category.focus()}),menu_window_delete_btn.addEventListener("click",()=>{menu_window_add.classList.contains("active")&&menu_window_add.classList.remove("active"),menu_window_delete.classList.add("active"),menu_window_delete_input_category.focus()}),menu_window_add_close.addEventListener("click",()=>{menu_window_add.classList.remove("active"),menu_window_add_input_category.value=""}),menu_window_delete_close.addEventListener("click",()=>{menu_window_delete.classList.remove("active"),menu_window_delete_input_category.value=""}),menu_window_add_category.addEventListener("click",()=>{let a=!0,b=menu_window_add_input_category.value.escape(),c=b.toLowerCase().replaceAll(" ","_"),d=document.getElementById(c);if(""==b&&(a=!1,showError("\u0423 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C \u0438\u043C\u044F!")),d&&(a=!1,showError("\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F \u0441 \u0442\u0430\u043A\u0438\u043C \u0438\u043C\u0435\u043D\u0435\u043C \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!")),a){let a=document.createElement("div"),c=document.createElement("p"),d=b.toLowerCase().replaceAll(" ","_");a.classList.add("main__group"),c.classList.add("main__group-title"),c.innerHTML=b,a.setAttribute("id",d),a.appendChild(c),menu_window_add_input_category.value="",add_category(main,a,b)}}),menu_window_delete_category.addEventListener("click",()=>{let a=!0,b=menu_window_delete_input_category.value;""==b&&showError("\u0427\u0442\u043E\u0431\u044B \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u043E \u0438\u043C\u044F!");let c=b.toLowerCase().replaceAll(" ","_").escape();console.log(c);let d=document.getElementById(c);if(null==d&&(a=!1,showError("\u0427\u0442\u043E\u0431\u044B \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E \u043D\u0443\u0436\u043D\u043E \u0432\u0432\u0435\u0441\u0442\u0438 \u0435\u0451 \u0438\u043C\u044F!")),a){menu_window_delete_input_category.value="";let a=d.parentNode;delete_category(a,d,b)}});function add_category(a,b,c){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"add_category",data:{jwt:localStorage.getItem("jwt"),category_name:encodeURI(c)}})}).then(d=>{let e=d.status;return 200==e?d.json():void(400==e?document.location.reload():401==e?(newJWT(),add_category(a,b,c)):500==e?document.location.reload():503==e&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{add_category(a,b,c)},5e3)))}).then(c=>{c.success?(a.appendChild(b),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0434\u0430\u0431\u043E\u0432\u043B\u0435\u043D\u043D\u043E \u043D\u043E\u0432\u0443\u044E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function delete_category(a,b,c){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"delete_category",data:{jwt:localStorage.getItem("jwt"),category_name:encodeURI(c)}})}).then(b=>{let d=b.status;return 200==d?b.json():void(400==d?document.location.reload():401==d?(newJWT(),delete_category(a,c)):500==d?document.location.reload():503==d&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{delete_category(a,c)},5e3)))}).then(c=>{c.success?(a.removeChild(b),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u043E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function add_item(a,b,c,d){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"add_item",data:{jwt:localStorage.getItem("jwt"),item_name:encodeURI(c),category_name:encodeURI(d)}})}).then(e=>{let f=e.status;return 200==f?e.json():void(400==f?document.location.reload():401==f?(newJWT(),add_item(a,b,c,d)):500==f?document.location.reload():503==f&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{add_item(a,b,c,d)},5e3)))}).then(c=>{c.success?(a.appendChild(b),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0434\u0430\u0431\u043E\u0432\u043B\u0435\u043D\u043D\u043E \u043D\u043E\u0432\u044B\u0439 \u044D\u043B\u0435\u043C\u0435\u043D\u0442!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function delete_item(a,b,c,d){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"delete_item",data:{jwt:localStorage.getItem("jwt"),item_name:encodeURI(c),category_name:encodeURI(d)}})}).then(e=>{let f=e.status;return 200==f?e.json():void(400==f?document.location.reload():401==f?(newJWT(),delete_item(a,b,c,d)):500==f?document.location.reload():503==f&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u044E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u0443\u044E \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{delete_item(a,b,c,d)},5e3)))}).then(c=>{c.success?(a.removeChild(b),showSuccess("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043D\u043E \u044D\u043B\u0435\u043C\u0435\u043D\u0442!")):showError(c.data.error)}).catch(()=>{showError("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443!")})}function search(a){const b=document.querySelectorAll(".main__group");let c=[],d=[];b.forEach(a=>{let b=[];if(a.hasChildNodes()){let c=a.childNodes,d=c.length;c.forEach(a=>{if(3!=a.nodeType)if(0!=a.childElementCount){let c=a.children[0].innerText.toLowerCase();b.push(c)}else{let c=a.innerText;b.push(c)}})}c.push({innerText:b})}),c.forEach(b=>{let c=!1;b.innerText.forEach(b=>{b.includes(a.toLowerCase())&&(c=!0)}),c&&d.push(b.innerText[0])}),0<d.length?(d.forEach(a=>{let b=document.getElementById(a.escape().toLowerCase().replaceAll(" ","_")).cloneNode(!0);search_output.appendChild(b)}),search_output.classList.add("active"),search_div.classList.add("active"),main.classList.add("disable"),showWarning("\u0417\u0434\u0435\u0441\u044C \u0432\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0441\u043C\u0430\u0442\u0440\u0438\u0432\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438!")):showError("\u041F\u043E \u0432\u0430\u0448\u0435\u043C\u0443 \u0437\u0430\u043F\u0440\u043E\u0441\u0443 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E.")}function newRJWT(){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"new_rjwt",data:{rjwt:localStorage.getItem("rjwt")}})}).then(a=>{let b=a.status;return 200==b?a.json():void(400==b?document.location.reload():401==b?document.location.reload():500==b?newRJWT():503==b&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0432\u043E\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0438\u043C \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{newRJWT()},5e3)))}).then(a=>{a.success&&localStorage.setItem("rjwt",a.data.rjwt)}).catch(()=>{})}function newJWT(){fetch("http://api.catalog.cc/",{method:"POST",body:JSON.stringify({action:"new_jwt",data:{rjwt:localStorage.getItem("rjwt"),jwt:localStorage.getItem("jwt")}})}).then(a=>{let b=a.status;return 200==b?a.json():void(400==b?document.location.reload():401==b?document.location.reload():500==b?newJWT():503==b&&(showWarning("\u0421\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0432\u043E\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0438\u043C \u043F\u043E\u0437\u0436\u0435."),setTimeout(()=>{newJWT()},5e3)))}).then(a=>{a.success&&localStorage.setItem("jwt",a.data.jwt)}).catch(()=>{})}function showError(a){success_window.classList.contains("active")&&success_window.classList.remove("active"),warning_window.classList.contains("active")&&warning_window.classList.remove("active");let b=error_window.children[0];b.innerHTML=a,error_window.classList.add("active"),setTimeout(()=>{error_window.classList.remove("active")},1e4)}function showWarning(a){success_window.classList.contains("active")&&success_window.classList.remove("active"),error_window.classList.contains("active")&&error_window.classList.remove("active");let b=warning_window.children[0];b.innerHTML=a,warning_window.classList.add("active"),setTimeout(()=>{warning_window.classList.remove("active")},1e4)}function showSuccess(a){error_window.classList.contains("active")&&error_window.classList.remove("active"),warning_window.classList.contains("active")&&warning_window.classList.remove("active");let b=success_window.children[0];b.innerHTML=a,success_window.classList.add("active"),setTimeout(()=>{success_window.classList.remove("active")},1e4)}String.prototype.escape=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return this.replace(/[&<>]/g,function(b){return a[b]||b})};